<?xml version="1.0" encoding="UTF-8"?>
<operation id="912d8b3b-492c-4b1d-8b1c-57450b9909e0">
  <descriptionCdata><![CDATA[912d8b3b-492c-4b1d-8b1c-57450b9909e0.description=<pre>\nThis determines which process on a machine has used the most CPU time\n\nInputs\:\n\thost\:           host name to check\n\tusername\:       user name to login into host as\n\tpassword\:       password to use for login\n\nResponses\:\n\tsuccess\:          If the operation worked\n\thost not found\:  If the host cannot be found\n\tauthentication failure\: If the login fails\n\tfailure\:          Any other error condition\n\nResults and Context\:\n\tThe process name is placed into the operation result\n\tThe process name is placed into the context variable "largestProcess"\n\tThe PID is placed into the context variable "PID"\n\tThe number of seconds used is placed into "maxSeconds"\n</pre>
]]></descriptionCdata>
  <annotation>912d8b3b-492c-4b1d-8b1c-57450b9909e0.description</annotation>
  <name>Process using the most CPU time</name>
  <categories/>
  <inputs>
    <userInputBinding id="f2fe3ca0-7720-4553-9168-93046beefad6">
      <annotation></annotation>
      <assignFromContext>false</assignFromContext>
      <assignToContext>false</assignToContext>
      <inputType>STRING</inputType>
      <isList>false</isList>
      <required>true</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>host</inputSymbol>
      <listDelimiter>,</listDelimiter>
      <record>false</record>
      <prompt></prompt>
      <isMultiSelect>false</isMultiSelect>
      <sourceDelimiter>|</sourceDelimiter>
    </userInputBinding>
    <userInputBinding id="c2ab0e30-5582-4297-aa29-fcdbe700784b">
      <annotation></annotation>
      <assignFromContext>false</assignFromContext>
      <assignToContext>false</assignToContext>
      <inputType>STRING</inputType>
      <isList>false</isList>
      <required>true</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>username</inputSymbol>
      <listDelimiter>,</listDelimiter>
      <record>false</record>
      <prompt></prompt>
      <isMultiSelect>false</isMultiSelect>
      <sourceDelimiter>|</sourceDelimiter>
    </userInputBinding>
    <userInputBinding id="9806cce2-ca37-42d7-b2fe-8176cec09b22">
      <annotation></annotation>
      <assignFromContext>false</assignFromContext>
      <assignToContext>false</assignToContext>
      <inputType>ENCRYPTED</inputType>
      <isList>false</isList>
      <required>true</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>password</inputSymbol>
      <listDelimiter>,</listDelimiter>
      <record>false</record>
      <prompt></prompt>
      <isMultiSelect>false</isMultiSelect>
      <sourceDelimiter>|</sourceDelimiter>
    </userInputBinding>
    <userInputBinding id="4c3ac92b-59d0-4715-9e80-8d2c354fff70">
      <annotation></annotation>
      <toContextKey></toContextKey>
      <assignFromContext>false</assignFromContext>
      <assignToContext>false</assignToContext>
      <inputType>STRING</inputType>
      <recordKey></recordKey>
      <isList>false</isList>
      <required>false</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>Environment</inputSymbol>
      <listDelimiter></listDelimiter>
      <record>false</record>
      <prompt></prompt>
      <isMultiSelect>false</isMultiSelect>
      <sourceDelimiter>|</sourceDelimiter>
    </userInputBinding>
    <staticBinding id="8fe3b4d6-bda3-42e9-9a32-6c2ac3c5b00b">
      <annotation></annotation>
      <toContextKey></toContextKey>
      <fromContextKey></fromContextKey>
      <assignFromContext>false</assignFromContext>
      <assignToContext>false</assignToContext>
      <inputType>STRING</inputType>
      <recordKey></recordKey>
      <isList>false</isList>
      <required>false</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>User</inputSymbol>
      <listDelimiter></listDelimiter>
      <value>${username}</value>
      <record>false</record>
    </staticBinding>
    <staticBinding id="48113152-92c4-4fe6-8117-1c789422fcdd">
      <annotation></annotation>
      <toContextKey></toContextKey>
      <fromContextKey></fromContextKey>
      <assignFromContext>false</assignFromContext>
      <assignToContext>false</assignToContext>
      <inputType>STRING</inputType>
      <recordKey></recordKey>
      <isList>false</isList>
      <required>true</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>Command</inputSymbol>
      <listDelimiter></listDelimiter>
      <value>ps -edal</value>
      <record>false</record>
    </staticBinding>
    <userInputBinding id="75b6bc9f-90cb-4698-aa08-35c05f0a954b">
      <annotation></annotation>
      <toContextKey></toContextKey>
      <assignFromContext>false</assignFromContext>
      <assignToContext>false</assignToContext>
      <inputType>STRING</inputType>
      <recordKey></recordKey>
      <isList>false</isList>
      <required>false</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>Argument</inputSymbol>
      <listDelimiter></listDelimiter>
      <record>false</record>
      <prompt></prompt>
      <isMultiSelect>false</isMultiSelect>
      <sourceDelimiter>|</sourceDelimiter>
    </userInputBinding>
    <staticBinding id="31eddc22-d2ed-49a6-9275-3a03c444872b">
      <annotation></annotation>
      <toContextKey></toContextKey>
      <fromContextKey></fromContextKey>
      <assignFromContext>false</assignFromContext>
      <assignToContext>false</assignToContext>
      <inputType>STRING</inputType>
      <recordKey></recordKey>
      <isList>false</isList>
      <required>false</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>Host</inputSymbol>
      <listDelimiter></listDelimiter>
      <value>${host}</value>
      <record>false</record>
    </staticBinding>
    <userInputBinding id="8c28b77f-0760-4280-939b-83cf1b36ca87">
      <annotation></annotation>
      <toContextKey></toContextKey>
      <assignFromContext>false</assignFromContext>
      <assignToContext>false</assignToContext>
      <inputType>STRING</inputType>
      <recordKey></recordKey>
      <isList>false</isList>
      <required>false</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>Private_Key_File</inputSymbol>
      <listDelimiter></listDelimiter>
      <record>false</record>
      <prompt></prompt>
      <isMultiSelect>false</isMultiSelect>
      <sourceDelimiter>|</sourceDelimiter>
    </userInputBinding>
    <staticBinding id="0a947055-fcb7-4d4e-b76b-c52414ef6e1f">
      <annotation></annotation>
      <toContextKey></toContextKey>
      <fromContextKey></fromContextKey>
      <assignFromContext>false</assignFromContext>
      <assignToContext>false</assignToContext>
      <inputType>ENCRYPTED</inputType>
      <recordKey></recordKey>
      <isList>false</isList>
      <required>false</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>Password</inputSymbol>
      <listDelimiter></listDelimiter>
      <value>{OBFUSCATED}SqstnSxglAP4D4gm72ILRw==</value>
      <record>false</record>
    </staticBinding>
    <userInputBinding id="c8667fd3-385a-40e7-85d7-e863512c72fc">
      <annotation></annotation>
      <toContextKey></toContextKey>
      <assignFromContext>false</assignFromContext>
      <assignToContext>false</assignToContext>
      <inputType>STRING</inputType>
      <recordKey></recordKey>
      <isList>false</isList>
      <required>false</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>Pty</inputSymbol>
      <listDelimiter></listDelimiter>
      <record>false</record>
      <prompt></prompt>
      <isMultiSelect>false</isMultiSelect>
      <sourceDelimiter>|</sourceDelimiter>
    </userInputBinding>
  </inputs>
  <scriptlet id="69d27efc-f9cb-4c62-857c-80792456725f">
    <annotation></annotation>
    <name>Operation Process using the most CPU time (8089d41c-c90f-4186-8368-8c77ea7e78cd)</name>
    <script>/*
   This operation runs ps to get the amount of overall CPU time used by each process
   The scriptlet reads the total CPU time from each row and finds the one with highest 
   amount of time used.  Note that this could also be accomplished by piping the output 
   of the ps command through sort and then selecting the top row (ignoring headers).  
   However we&apos;ll do it manually here to illustrate the technique.

   The process that used the most time is placed into the context variable largestProcess
   The amount of CPU time it has used is placed into the context variable maxSeconds
   The pid of the process is placed into the context variable PID

   Returns:
	&quot;Passed&quot; if the operation worked
	&quot;Host Not Found&quot; if we failed to find the host
	&quot;Authentication Failure&quot; if we found the host but couldn&apos;t log in
	&quot;Failed&quot; if there is any other error condition
*/

// set up defaults
scriptletResult = &quot;-1&quot;;
scriptletResponse = &quot;failure&quot;;

// get the command output data
data = scriptletRawResult[&apos;Output String&apos;];

// get the return code
code = parseInt(scriptletRawResult[&apos;Code&apos;]);

maxSeconds = 0;

// make sure the command executed correctly
if (code == 0) {

	// split the data into lines
	splitdata = data.split(/\n/);

	// add up the % free from each line ignoring the header
	for (i = 1; ; i++) {
		// get the individual row
		row = splitdata[i];
		// if there is no data we are done
		if (row == null) break;

		// find the hh:mm:ss column using a regular expression
		cpuUsed = row.match(/(.*\s+)(\d+:\d+:\d+)(.*)/);

		// cut into hours, minutes, seconds
		if (cpuUsed != null) {
			time = cpuUsed[2].split(/:/);
			hours = parseInt(time[0]);
			minutes = parseInt(time[1]);
			seconds = parseInt(time[2]);
			// convert from hh:mm:ss into total seconds
			totalSeconds = seconds + (60 * minutes) + (3600 * hours);
			// is this the largest so far?
			if (totalSeconds &gt; maxSeconds) {
				maxSeconds = totalSeconds;
				// split the row into columns
				findProcess = row.split(/\s+/);
				// get the process name
				largestProcess = findProcess[13];
				// get the PID
				largestProcessPID = findProcess[3]
			}
		}
	} 

	// finalize the return variables
	scriptletResponse = &quot;success&quot;;
	scriptletResult = largestProcess;
	
	// place the process name, PID and amount of CPU used into the context
	scriptletContext.putGlobal(&quot;largestProcess&quot;, largestProcess);
	scriptletContext.putGlobal(&quot;PID&quot;, largestProcessPID);
	scriptletContext.putGlobal(&quot;maxSeconds&quot;, maxSeconds);
}
else
{
	// check for a host not found
	errorstring = scriptletRawResult[&apos;Error String&apos;];
	if (errorstring.match(/.*UnknownHost.*/) != null) {
		scriptletResponse = &quot;host not found&quot;;
	}
	// look for an authentication error
	else if (errorstring.match(/.*Authentication failure.*/) != null) {
		scriptletResponse = &quot;authentication failure&quot;;
	}
	// generic error response
	else {
		scriptletResponse = &quot;failure&quot;;
	}
}

</script>
    <type>RHINO</type>
  </scriptlet>
  <possibleResponses>
    <opResponse id="577c5c67-26d7-4c09-b09c-e961bc3a5b9f">
      <annotation></annotation>
      <name>success</name>
      <isDefault>false</isDefault>
      <onFailure>false</onFailure>
      <type>RESOLVED</type>
      <matchRules/>
    </opResponse>
    <opResponse id="93544bb6-4b7c-47a1-bc48-21cad3cfcae3">
      <annotation></annotation>
      <name>failure</name>
      <isDefault>true</isDefault>
      <onFailure>false</onFailure>
      <type>ERROR</type>
      <matchRules/>
    </opResponse>
    <opResponse id="14c32d18-a9ac-4d10-a1b0-ae998cb6d16c">
      <annotation></annotation>
      <name>host not found</name>
      <isDefault>false</isDefault>
      <onFailure>false</onFailure>
      <type>NO_ACTION_TAKEN</type>
      <matchRules/>
    </opResponse>
    <opResponse id="f5e57639-0237-4918-a595-53d53a9d4068">
      <annotation></annotation>
      <name>authentication failure</name>
      <isDefault>false</isDefault>
      <onFailure>false</onFailure>
      <type>NO_ACTION_TAKEN</type>
      <matchRules/>
    </opResponse>
  </possibleResponses>
  <availableResultExpressions/>
  <resultExpression id="2dc743c9-17a0-4379-9b80-1273ebcb5cda">
    <annotation></annotation>
    <name>Code</name>
    <fieldName>Code</fieldName>
    <sourceType>RAWRESULT</sourceType>
    <filters/>
  </resultExpression>
  <iconSpec id="7a7259cc-309c-47fd-a665-1cf2c37a289d">
    <baseIcon>cpu.png</baseIcon>
    <basePath>Operating System/</basePath>
    <readOnly>false</readOnly>
    <layers>
      <iconSpec id="3a15774f-f83e-42fe-ae44-49032d576ce7">
        <baseIcon>view.png</baseIcon>
        <basePath>Annotations/</basePath>
        <readOnly>false</readOnly>
        <layers/>
      </iconSpec>
    </layers>
  </iconSpec>
  <opRef>
    <refId>46c0f7ea-a981-4ddc-bcaf-d4faed7af0b6</refId>
  </opRef>
  <fieldValues/>
  <groupAliasRef>
    <refId>5233030c-af46-432b-a682-b326ca6bf2ae</refId>
    <refName>RAS_Operator_Path</refName>
  </groupAliasRef>
  <overrideGroupAlias>${overrideJRAS}</overrideGroupAlias>
</operation>