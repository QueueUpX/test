<?xml version="1.0" encoding="UTF-8"?>
<operation id="ea13ea12-9074-4a74-8f03-b6cbd596bdfb">
  <descriptionCdata><![CDATA[ea13ea12-9074-4a74-8f03-b6cbd596bdfb.description=<pre>\nScans for a specified HTML tag and returns the content found between that tag and its closing tag. \n\nInputs\:\n    html - The HTML to parse. This is the actual HTML, not the path to an HMTL file.\n    occurrenceNumber - Specifies which flagged section to return. A value of '1' indicates the first section, '2' the second and so on. A value of '0' indicates the return of the entire document.\n    startTag - The HTML tag to parse on. \nExample\: <table>\n    endTag - The closing HTML tag to parse on.\nExample\: </table>\n\nResults\:\n    Result - The information contained between the <startTag> and <endTag>. \n\nResponses\:\n    success - The operation completed as stated in the description.\n    failure - The operation completed unsuccessfully. The html does not have enough occurrences of tag.\n\nNote\:\nThis operation adds to the context two variables <htmlParamNames> and <htmlParamValues>. These two variables contain the names and the values of the HTML attributes present in the tag found by the operation. For example, if the tag that is found is something like \n    <table dir\="rtl" align\="center"> ... </table>\nthe two variables are\:\n    htmlParamNames\: dir,align\n    htmlParamValues\: rtl,center\nIn a flow containing an "HTML Parser" step, these two variables can be fetched from the context and used in subsequent steps.\n\nExample\:\nIf the tag is 'table', everything between <table> and </table> is returned. The function does support nested tables\:\n<table>\nfoo\n<table>\nbar\n</table>\n</table>\n<table>\nmoo\n</table>\nThe inner table ('bar') cannot be retrieved. \n'foo' or 'moo' can be retrieved. If 'foo' is retrieved, it contains the 'bar' sub-table.\n</pre>
]]></descriptionCdata>
  <annotation>ea13ea12-9074-4a74-8f03-b6cbd596bdfb.description</annotation>
  <name>HTML Parser</name>
  <categories/>
  <inputs>
    <userInputBinding id="1ab3cf7f-427a-4a24-9cc6-8e95a37efc82">
      <annotation></annotation>
      <assignFromContext>true</assignFromContext>
      <assignToContext>true</assignToContext>
      <inputType>STRING</inputType>
      <isList>false</isList>
      <required>true</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>html</inputSymbol>
      <listDelimiter>,</listDelimiter>
      <record>false</record>
      <prompt></prompt>
      <isMultiSelect>false</isMultiSelect>
      <sourceDelimiter>|</sourceDelimiter>
    </userInputBinding>
    <userInputBinding id="da7b69a4-32be-4000-9c7f-2632e7525b35">
      <annotation></annotation>
      <assignFromContext>true</assignFromContext>
      <assignToContext>true</assignToContext>
      <inputType>STRING</inputType>
      <isList>false</isList>
      <required>true</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>occurrenceNumber</inputSymbol>
      <listDelimiter>,</listDelimiter>
      <record>false</record>
      <prompt></prompt>
      <isMultiSelect>false</isMultiSelect>
      <sourceDelimiter>|</sourceDelimiter>
    </userInputBinding>
    <userInputBinding id="7602b9be-a6b0-43aa-802d-2cf0f9e62c38">
      <annotation></annotation>
      <assignFromContext>true</assignFromContext>
      <assignToContext>true</assignToContext>
      <inputType>STRING</inputType>
      <isList>false</isList>
      <required>true</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>startTag</inputSymbol>
      <listDelimiter>,</listDelimiter>
      <record>false</record>
      <prompt></prompt>
      <isMultiSelect>false</isMultiSelect>
      <sourceDelimiter>|</sourceDelimiter>
    </userInputBinding>
    <userInputBinding id="e41228d7-4c6c-44d4-92c3-f143190e5a6d">
      <annotation></annotation>
      <assignFromContext>true</assignFromContext>
      <assignToContext>true</assignToContext>
      <inputType>STRING</inputType>
      <isList>false</isList>
      <required>true</required>
      <isPersisted>true</isPersisted>
      <inputSymbol>endTag</inputSymbol>
      <listDelimiter>,</listDelimiter>
      <record>false</record>
      <prompt></prompt>
      <isMultiSelect>false</isMultiSelect>
      <sourceDelimiter>|</sourceDelimiter>
    </userInputBinding>
  </inputs>
  <scriptlet id="dc88c290-4755-4561-8d3d-d8eb402d955e">
    <annotation></annotation>
    <name>Operation HTML Parser (8134028a-5a26-4410-ac88-2c03b6daa823)</name>
    <script>scriptletResponse = &quot;failure&quot;;
try{
var test = occurrenceNumber.replace(/0|([1-9][0-9]*)/, &quot;&quot;);
if (test != null &amp;&amp; test != &quot;&quot;)
    throw new java.lang.Exception(&quot;Invalid occurrenceNumber input: must be 0 or a valid positive integer&quot;);
var index = parseInt(occurrenceNumber);
var paramNames = &quot;&quot;;
var paramVals = &quot;&quot;;
var usedEndTag = &quot;&quot;;
endTag = endTag.toLowerCase();
startTag = startTag.toLowerCase();
if (startTag.charAt(startTag.length-1) == &apos;&gt;&apos; &amp;&amp; startTag.indexOf(&apos; &apos;) == -1)
    startTag = startTag.substring(0, startTag.length-1);

var excText = &quot;Unable to find specified tag or occurrence of tag&quot;;
if (occurrenceNumber &gt; countOccurrences(startTag, html))
    throw new java.lang.Exception(excText);

while (html.length &gt; 0 &amp;&amp; index &gt;0){

	var htmlLC = html.toLowerCase();
	var subStart = htmlLC.indexOf(startTag);//indexOfCaseless(html,startTag); 
    if (subStart &lt; 0)
		throw new java.lang.Exception(excText);
	var accum = subStart;
	var end = getEnd(subStart+1);
	index --;	
	if (index == 0){
		var paramsEnd = getEndParamsIndex(subStart, html);
		getParams(html.substring(subStart+startTag.length , paramsEnd));
		subStart = getEndParamsIndex(subStart, html);
		html = html.substring(subStart + 1 , end);
	}
	else
		html = html.substring(end+(usedEndTag).length+1, html.length); 
}
scriptletContext.put(&quot;htmlParamNames&quot;, paramNames);
scriptletContext.put(&quot;htmlParamValues&quot;, paramVals);
scriptletResponse = &quot;success&quot;;
scriptletResult = &quot;&quot;+html;
}
catch (e){
scriptletResponse = &quot;failure&quot;;
scriptletResult = &quot;&quot;+e;
}

function indexOfCaseless(container, toFind){
	return indexOfCaselss(container,toFind,0);
}

function indexOfCaseless(container, toFind, offset){
	return container.toLowerCase().indexOf(toFind.toLowerCase(), offset);
}

function getParams(info){
	info = info.replace(/\s+&amp;/, &quot;&quot;);
	info = info.replace(/^\s+/, &quot;&quot;);
	var split = info.split(/^([^\s=]+)=*(&quot;[^&quot;]*&quot;|\S*)/);
	while (split != null &amp;&amp; split.length &gt; 2){
		if (paramNames != null &amp;&amp; paramNames.length &gt; 0)
			paramNames +=&quot;,&quot;;
		if (paramNames != null &amp;&amp; paramNames.length &gt; 0)
			paramVals +=&quot;,&quot;;
		paramNames += split[1];
		if(split[2].indexOf(&quot;\&quot;&quot;)==0)
			paramVals += split[2].substring(1, split[2].length-1);
		else
			paramVals += split[2];
		if (split.length &gt; 3)
			split = split[3].replace(/^\s+/, &quot;&quot;).split(/^([^\s=]+)=*(&quot;[^&quot;]*&quot;|\S*)/);
		else
			split = null
	}
}

function trimGRLT(toTrim){
	toTrim = toTrim.replace(/&lt;+&amp;/, &quot;&quot;);
	toTrim = toTrim.replace(/^&lt;+/, &quot;&quot;);
	toTrim = toTrim.replace(/&gt;+&amp;/, &quot;&quot;);
	toTrim = toTrim.replace(/^&gt;+/, &quot;&quot;);
	return toTrim;
}

function getEndParamsIndex(offset, toParse){
	var quoteStart = html.indexOf(&quot;\&quot;&quot;, subStart);
	var gtStart = html.indexOf(&quot;&gt;&quot;, subStart);
	while (quoteStart &lt;gtStart &amp;&amp; quoteStart &gt;=0){
		quoteStart = html.indexOf(&quot;\&quot;&quot;, quoteStart+1);
		gtStart = html.indexOf(&quot;&gt;&quot;, quoteStart+1);
		quoteStart = html.indexOf(&quot;\&quot;&quot;, quoteStart+1);
	}
	return gtStart;
}

function getEnd(offset) {
	//var end = indexOfCaseless(html, endTag, offset);
	var end = htmlLC.indexOf(endTag, offset);
	var temp = html.substring(end, html.length);
	if (endTag == &quot;&lt;&quot;){
		var proposedEnd = &quot;&lt;/&quot;+trimGRLT(startTag)
		if(temp.toLowerCase().indexOf(proposedEnd) == 0){
		//if (indexOfCaseless(temp, proposedEnd)==0){
			//end = indexOfCaseless(html, proposedEnd, offset);
			end = htmlLC.indexOf(proposedEnd, offset);
			usedEndTag = proposedEnd;
		}
	}
	else
		usedEndTag = endTag;
	//var recCheck = indexOfCaseless(html, startTag, offset);
	var recCheck = htmlLC.indexOf(startTag, offset);
	while (recCheck &lt; end &amp;&amp; recCheck &gt;= 0 &amp;&amp; end &gt;=0){
		if (recCheck &gt; end)
			return end;
		else
			offset = getEnd(recCheck+1)+1; 
		//recCheck = indexOfCaseless(html, startTag, offset);
		recCheck = htmlLC.indexOf(startTag, offset);
		//end = indexOfCaseless(html, endTag, offset);
		end = htmlLC.indexOf(endTag, offset);
	}
	if (end &gt; 0)
		return end
	else
		return html.length-1;
}

function countOccurrences(string, text) {
	var count = -1;
	var previous = text;
	do {
		count++;
		previous = text;
		text = text.replace(string, &quot;&quot;);
	} while(previous != text);	
	return count;
}</script>
    <type>RHINO</type>
  </scriptlet>
  <possibleResponses>
    <opResponse id="06d65901-e4aa-420a-81dd-637ae5bbc5ef">
      <annotation></annotation>
      <name>success</name>
      <isDefault>false</isDefault>
      <onFailure>false</onFailure>
      <type>RESOLVED</type>
      <matchRules/>
    </opResponse>
    <opResponse id="9121423c-80e4-4710-a10c-6caed5479c22">
      <annotation></annotation>
      <name>failure</name>
      <isDefault>true</isDefault>
      <onFailure>true</onFailure>
      <type>ERROR</type>
      <matchRules/>
    </opResponse>
  </possibleResponses>
  <availableResultExpressions/>
  <resultExpression id="d51c2042-9688-4529-8426-00c55d0d392a">
    <annotation></annotation>
    <name>returnResult</name>
    <fieldName>returnResult</fieldName>
    <sourceType>RAWRESULT</sourceType>
    <filters/>
  </resultExpression>
  <iconSpec id="0634b02f-c0fd-4eb8-8d30-aa7306de7484">
    <baseIcon>website.png</baseIcon>
    <basePath>Application/</basePath>
    <readOnly>false</readOnly>
    <layers>
      <iconSpec id="904d8493-3434-4883-97c1-71bdce26fb95">
        <baseIcon>wrench.png</baseIcon>
        <basePath>Annotations/</basePath>
        <readOnly>false</readOnly>
        <layers/>
      </iconSpec>
    </layers>
  </iconSpec>
  <opRef>
    <refId>ddd79f22-8b1e-4605-88d5-d912bb2da2b9</refId>
  </opRef>
  <fieldValues/>
  <groupAliasRef>
    <refId>5233030c-af46-432b-a682-b326ca6bf2ae</refId>
    <refName>RAS_Operator_Path</refName>
  </groupAliasRef>
  <overrideGroupAlias>${overrideJRAS}</overrideGroupAlias>
</operation>